0  TEXT : HOME : CLEAR 512,15535: GOSUB 65000: RESTORE 0
15 R =  RND ( - ( PEEK (263) +  PEEK (264) * 256) * 2 ^  - 24): REM RANDOMIZE
20  DEF  FN R(X) =  INT ( RND (1) * X) + 1
30  GOSUB 190
40  GOSUB 470
50  GOSUB 860
60  REM LOOP
70  FOR I = 1 TO 8
80  IF T(I,1) < 4 THEN  GOSUB 1380: IF YW > 2 THEN  GOSUB 1900
90  IF T(I,1) < 5 THEN  POKE 277,T(I,8): POKE 278,T(I,9):N =  USR (U$(I))
100  NEXT I
110  FOR E = 9 TO 16
120  IF T(E,1) < 4 THEN  GOSUB 2140
130  NEXT E
140  GOSUB 1020
150  GOSUB 2290
160  IF VC <  > 1 AND DE <  > 1 THEN  GOTO 60
170  GOSUB 2380
175  GOSUB 2410
180  TEXT : END
190  REM INICIALIZACAO
200 VC = 0:DE = 0
210  RESTORE 2570: FOR K = 0 TO 13: FOR I = 0 TO 7
220  READ B: POKE 16128 + K * 8 + I,B
290  NEXT I,K: REM DEFINE SPRITES CHR$(96) A CHR$ (109)
340  HGR
350  DIM M(16,30)
355  DIM T(16,9)
360  DIM T$(8),O$(5),W$(5),M$(5),A$(4),R$(4),C(8)
370 I$ = "NOSL"
380  RESTORE 2760: FOR J = 1 TO 5: READ O$(J),W$(J),M$(J): NEXT J
390  FOR J = 1 TO 8: READ T$(J): NEXT J
400  FOR J = 1 TO 4: READ A$(J),R$(J): NEXT J
410  DIM U$(16):U$(1) =  CHR$ (100):U$(2) =  CHR$ (101):U$(3) =  CHR$ (102):U$(4) =  CHR$ (102):U$(5) =  CHR$ (103):U$(6) =  CHR$ (103):U$(7) =  CHR$ (104):U$(8) =  CHR$ (104)
411 U$(9) =  CHR$ (105):U$(10) =  CHR$ (106):U$(11) =  CHR$ (107):U$(12) =  CHR$ (107):U$(13) =  CHR$ (108):U$(14) =  CHR$ (108):U$(15) =  CHR$ (109):U$(16) =  CHR$ (109)
416 SP = 1
420  RETURN
470  REM CRIACAO
480  FOR I = 1 TO 16: GOSUB 800:M(I,1) = R: NEXT I
490  FOR I = 1 TO 16
500  FOR J = 2 TO 30
510 S =  FN R(10)
520  IF S < 8 THEN  GOSUB 800
525  IF S >  = 8 THEN R = M(I,J - 1)
530 M(I,J) = R
540  IF R = 3 AND J < 30 THEN M(I,J + 1) = 4
550  IF M(I,J) <  > 0 AND M(I,J) <  > 3 THEN  POKE 277,I: POKE 278,J:N =  USR ( CHR$ (96 + M(I,J) - 1))
555  IF M(I,J) = 3 AND J <  > 30 THEN  POKE 277,I: POKE 278,J:N =  USR ( CHR$ (98) +  CHR$ (99))
560  NEXT J,I
580  GOSUB 720
590  FOR I = 1 TO 8
600  FOR J = 1 TO 2:T(I,J) = 2:T(I + 8,J) = 2: NEXT J
610  FOR J = 3 TO 4: READ T(I,J):T(I + 8,J) = T(I,J): NEXT J
620  READ MR
630  FOR J = 0 TO 8 STEP 8
640 T(I + J,5) = MR +  FN R(2)
650 T(I + J,6) = ( FN R(100) * 10) + 10
660 T(I + J,7) = T(I + J,6)
665  IF J = 8 THEN T(I + J,6) = T(I + J,6) +  FN R(100):T(I + J,7) = T(I + J,6)
670  NEXT J
680 T(I,8) = 16
690 T(I + 8,8) = 1
700  NEXT I
710  RETURN
720  REM BORDA DECORATIVA
725  INVERSE
730  FOR I = 0 TO 17
740  POKE 277,I: POKE 278,0:N =  USR ( CHR$ (102)): POKE 278,31:N =  USR ( CHR$ (102))
750  NEXT I
760  FOR I = 1 TO 30
770  POKE 277,0: POKE 278,I:N =  USR ( CHR$ (102)): POKE 277,17:N =  USR ( CHR$ (102))
780  NEXT I
785  NORMAL
790  RETURN
800  REM ESCOLHE O TERRENO
810 R =  FN R(50)
820  IF R > 5 THEN R = 0
830  IF R > 4 THEN R = 3: RETURN
840  IF R > 1 THEN R = 2
850  RETURN
860  REM DISPOE TROPAS
880  FOR M = 1 TO 2
890 S = 1:R = 1
900  FOR K = 1 TO 8
910  REM LOOP
920 S =  FN R(8 * M)
930  IF T(S,9) <  > 0 THEN 910
940 R =  FN R(4) + R
950 R = R -  INT (R / 30)
960 T(S,9) = R
980  POKE 277,T(S,8): POKE 278,T(S,9):N =  USR (U$(S))
990  NEXT K
1000  NEXT M
1010  RETURN
1020  REM CUMPRE
1030  FOR I = 1 TO 16
1032  IF T(I,1) > 3 THEN 1140
1035  GOSUB 2540: POKE 277,18: POKE 278,0:N =  USR ("UNIDADE" +  STR$ (I) + " ENTRA EM ACAO!")
1037 TT = I: GOSUB 10000
1040  IF T(I,1) > 3 THEN 1140
1050  IF T(I,1) = 3 THEN B = I: GOSUB 1160
1055  IF T(I,1) = 2 THEN 1140
1060  IF T(I,1) = 1 THEN SH = I: GOSUB 1710: GOTO 1140
1070  FOR F =  - 1 TO 1
1080  FOR G =  - 1 TO 1
1090  FOR E = 1 TO 16
1100  IF (T(I,8) + F = T(E,8)) AND (T(I,9) + G = T(E,9)) AND T(E,1) <  > 5 THEN US = I:TH = E: GOSUB 1510
1110  NEXT E,G,F
1140  NEXT I
1150  RETURN
1160  REM MOVE UNIDADE
1170 OX = T(B,8):OY = T(B,9)
1175 GH = 32
1180  IF M(T(B,8),T(B,9)) <  > 0 THEN GH = 96 + M(T(B,8),T(B,9)) - 1
1190 D = 5 - T(B,4)
1200  IF B < 3 OR B = 9 OR B = 10 THEN D = D + 2
1210 V = T(B,2) - 1
1215 UP = 0:AL = V - 2
1220  IF (V / 2) -  INT (V / 2) = 0 THEN UP = V - 1:AL = 0
1230  REM REPETICAO
1240 N1 = T(B,9) + AL:NP = T(B,8) + UP
1250  IF NP < 1 THEN NP = 1
1260  IF NP > 16 THEN NP = 16
1270  IF N1 < 1 THEN N1 = 1
1280  IF N1 > 30 THEN N1 = 30
1290  IF M(NP,N1) > 0 THEN D = D - 1
1300  FOR K = 1 TO 8
1310  IF (T(K,9) = N1 AND T(K,8) = NP AND K <  > B) THEN D = 0
1315  IF (T(K + 8,9) = N1 AND T(K + 8,8) = NP AND K + 8 <  > B) THEN D = 0
1320  NEXT K
1330  IF D > 0 THEN T(B,9) = N1:T(B,8) = NP:D = D - 1
1340  IF D <  > 0 THEN 1240
1350  POKE 277,OX: POKE 278,OY:N =  USR ( CHR$ (GH))
1355 TT = B: GOSUB 10000
1360  POKE 277,T(B,8): POKE 278,T(B,9):N =  USR (U$(B))
1370  RETURN
1380  REM UNIDADE
1390  GOSUB 2540
1400 TT = I: GOSUB 10000
1410  POKE 277,T(I,8): POKE 278,T(I,9): INVERSE :N =  USR (U$(I)): NORMAL
1420  POKE 277,18: POKE 278,0:N =  USR ("UNIDADE" +  STR$ (I) + ":" + T$(I) + "      ")
1430  POKE 277,19:N$ = "ULTIMA ORDEM:" + O$(T(I,1)):N =  USR (N$)
1440  IF T(I,1) = 3 THEN  POKE 278, LEN (N$) + 1:N =  USR ( MID$ (I$,T(I,2),1))
1450  REM LOOP
1460  POKE 277,20: POKE 278,0:N =  USR ("QUER MUDAR AS ORDENS (S/N)?"): POKE 284,0
1465 YW = 0:Y$ =  CHR$ ( PEEK (284))
1470  IF Y$ = "N" THEN YW = 1
1480  IF Y$ = "S" THEN YW = 3
1490  IF YW = 0 THEN 1465
1500  RETURN
1510  REM COMBATE
1520  IF (US < 9 AND TH < 9) OR (US > 8 AND US > 8) THEN  RETURN
1530  IF T(US,1) = 5 OR T(TH,1) = 5 THEN  RETURN
1540  GOSUB 2540
1550  POKE 277,18: POKE 278,0:N =  USR ("COMBATE!!!")
1560 AT =  INT ((T(US,7) - T(TH,7)) / 50)
1570 AT = AT + T(US,3) - T(TH,4) + T(US,5) +  FN R(5)
1580  IF  ABS (T(US,2) - T(TH,2)) <  > 2 THEN AT = AT + 2
1590  IF US < 3 OR US = 9 OR US = 10 THEN AT = AT + 1
1600 DF =  INT ((T(TH,7) - T(US,7)) / 60)
1610 DF = DF + T(TH,3) - T(US,4) + T(TH,5) + M(T(TH,8),T(TH,9)) +  FN R(3) + 2
1615 WN = TH:LO = US
1620  IF AT > DF THEN WN = US:LO = TH
1630 WC =  INT (T(WN,7) / 10): IF WC < 1 THEN WC = 1
1640 T(WN,7) = T(WN,7) - WC
1650 LC =  INT (T(LO,7) / 5): IF LC < 1 THEN LC = 1
1660 T(LO,7) = T(LO,7) - LC
1665  IF WN > 8 THEN C(WN - 8) = 8
1666  IF LO > 8 THEN C(LO - 8) = T(WN,2)
1670  POKE 277,19: POKE 278,0:N =  USR ( STR$ (WN) + " PERDE" +  STR$ (WC) + "," +  STR$ (LO) + " PERDE" +  STR$ (LC))
1680  GOSUB 2410
1690 UN = LO: GOSUB 2200
1700  RETURN
1710  REM TIRO
1720  GOSUB 2540
1730  POKE 277,18: POKE 278,0:N =  USR ("UNIDADE" +  STR$ (SH) + " ATIRA")
1740 FX = 5:FY = 5:GP =  - 1
1745 ST = 9
1750  IF SH > 8 THEN ST = 1
1760 RA = ST:RB = SH:RC = FX:RD = FY: GOSUB 3000
1800  IF GP =  - 1 THEN  POKE 277,19: POKE 278,0:N =  USR ("FORA DE ALCANCE"): GOSUB 2410: RETURN
1810 C = 8 - T(GP,4) -  ABS (FX - FY)
1820  IF GP < 3 OR GP = 9 OR GP = 10 THEN C = C + 1
1830  IF M(T(GP,8),T(GP,9)) = 2 THEN C = C - 2
1840  IF T(GP,1) <  > 2 THEN C = C + 1
1850 C = (C + ( INT (T(SH,7) / 40)) +  FN R(3)) * 10
1860 T(GP,7) = T(GP,7) - C
1870  POKE 277,19: POKE 278,0:N =  USR ("HOUVE" +  STR$ (C) + " BAIXAS NA UNIDADE" +  STR$ (GP))
1875  GOSUB 2410
1880 UN = GP: GOSUB 2200
1890  RETURN
1900  REM ACAO
1910  GOSUB 2540
1920  POKE 277,18: POKE 278,0:N =  USR ("OPCOES:")
1930  FOR J = 1 TO 4
1940  POKE 277,17 + J: POKE 278,8:N =  USR ( LEFT$ (O$(J),1) + "-" + O$(J))
1950  NEXT J
1960  REM LOOP
1965  POKE 284,0
1970 A = 0:G$ =  CHR$ ( PEEK (284))
1980  IF G$ = "F" THEN A = 1
1981  IF G$ = "A" THEN A = 2
1982  IF G$ = "M" THEN A = 3
1983  IF G$ = "S" THEN A = 4
1990  IF A = 0 THEN 1970
2000  IF I <  > 6 AND I <  > 5 AND A = 1 THEN  GOSUB 2540: POKE 277,18: POKE 278,8:N =  USR ("NAO HA ARCOS"): GOSUB 2410: GOTO 1910
2010  IF A = 4 THEN  GOSUB 2440: RETURN
2020 T(I,1) = A
2030  IF A = 3 THEN  GOSUB 2050
2040  RETURN
2050  REM DIRECAO
2055  GOSUB 2540
2060  POKE 277,18: POKE 278,0:N =  USR ("PARA ONDE (NSLO)?")
2065 G = 0
2070  REM LOOP
2075  POKE 284,0
2080 G$ =  CHR$ ( PEEK (284))
2090  IF G$ = "N" THEN G = 1
2091  IF G$ = "O" THEN G = 2
2092  IF G$ = "S" THEN G = 3
2093  IF G$ = "L" THEN G = 4
2110  IF G = 0 THEN 2080
2120 T(I,2) = G
2130  RETURN
2140  REM INIMIGO
2142  REM LOOP
2143 R =  FN R(10)
2144  IF R = 1 OR T(SP,1) > 3 THEN SP =  FN R(8)
2145  IF R = 1 AND T(SP,1) > 3 THEN 2142
2150  IF C(E - 8) = 8 THEN  RETURN
2155  IF C(E - 8) <  > 0 THEN T(E,1) = 3:T(E,2) = C(E - 8):C(E - 8) = 0: RETURN
2160 T(E,1) =  FN R(3)
2170  IF T(E,3) = 2 THEN RA = 1:RB = E:RC = 5:RD = 5: GOSUB 3000: IF GP <  >  - 1 THEN T(E,1) = 1: RETURN
2180 T(E,1) = 3
2181 HP = 5:VP = 5:MV = 0
2182  FOR V = 1 TO 8
2183 ZP = 0: GOSUB 3100
2184  IF ZP <  > 0 THEN  GOSUB 3200
2185  NEXT V
2187  IF HP <  > 5 AND VP <  > 5 THEN  RETURN
2188  IF MV <  > 0 THEN T(E,2) = MV: RETURN
2189 HP = T(E,8) - T(SP,8):VP = T(E,9) - T(SP,9): GOSUB 3200
2190  RETURN
2200  REM MORAL
2210  IF T(UN,6) - T(UN,7) < ((T(UN,6) / 100) * ((T(UN,5) + 2))) THEN  RETURN
2220  GOSUB 2540
2230  POKE 277,18: POKE 278,0:N =  USR ("AS BAIXAS FORAM TAO GRANDES")
2240  POKE 277,19:N =  USR ("QUE A UNIDADE" +  STR$ (UN) + " SE DESINTEGRA")
2250  GOSUB 2410
2260 T(UN,1) = 5
2265 GH = 32: IF M(T(UN,8),T(UN,9)) <  > 0 THEN GH = 96 + M(T(UN,8),T(UN,9)) - 1
2270  POKE 277,T(UN,8): POKE 278,T(UN,9):N =  USR ( CHR$ (GH))
2280  RETURN
2290  REM VITORIA
2300 GD = 0:BD = 0
2310  FOR M = 1 TO 8
2320  IF T(M,1) <  > 5 THEN GD = GD + 1
2330  IF T(M + 8,1) <  > 5 THEN BD = BD + 1
2340  NEXT M
2350  IF GD > BD * 2 OR (BD < 2 AND GD > 2) THEN VC = 1
2360  IF BD > GD * 2 OR (GD < 2 AND BD > 2) THEN DE = 1
2370  RETURN
2380  REM FIM
2385  INVERSE
2390  IF VC = 1 THEN  POKE 277,21: POKE 278,11:N =  USR ("VITORIA!!!")
2395  IF DE = 1 THEN  POKE 277,21: POKE 278,5:N =  USR ("UMA HUMILHANTE DERROTA")
2397  NORMAL
2400  RETURN
2410  REM ATRASO
2420  POKE 277,23: POKE 278,8:N =  USR ("(QUALQUER TECLA)"): POKE 284,0
2425  IF  PEEK (284) = 0 THEN 2425
2430  RETURN
2440  REM STATUS
2450  GOSUB 2540
2460  POKE 277,18: POKE 278,0:N =  USR ("UNIDADE" +  STR$ (I)): POKE 278,15:N =  USR ("TIPO:" + T$(I))
2470  POKE 277,19: POKE 278,0:N =  USR ("ARMA:" + W$(T(I,3)))
2480  POKE 277,20:N =  USR ("ARMADURA:" + A$(T(I,4)))
2490  POKE 277,21:N =  USR ("PODER:" +  STR$ (T(I,7)))
2500  POKE 278,15:N =  USR ("MORAL:" + M$(T(I,5)))
2510  POKE 277,22: POKE 278,0:N =  USR ("TERRENO:" + R$(M(T(I,8),T(I,9)) + 1))
2520  GOSUB 2410
2530  RETURN
2540  REM LIMPA JANELA DE TEXTO
2550  FOR K = 18 TO 23
2555  POKE 277,K: POKE 278,0:N =  USR ("                                ")
2560  NEXT K: RETURN
2570  DATA 16,16,56,124,254,170,238,238
2580  DATA 16,56,84,16,56,84,146,16
2590  DATA 24,100,130,1,6,24,32,192
2600  DATA 0,48,72,132,2,0,0,0
2610  DATA 128,224,252,248,156,128,128,128
2620  DATA 64,240,72,68,68,68,78,68
2630  DATA 254,238,238,130,238,108,56,16
2640  DATA 0,242,140,76,50,50,10,6
2650  DATA 0,2,4,72,80,32,88,128
2660  DATA 2,14,126,62,114,2,2,2
2670  DATA 4,30,36,68,68,68,228,68
2680  DATA 254,238,214,186,214,108,56,16
2690  DATA 0,158,98,100,152,152,160,192
2700  DATA 0,128,64,36,20,8,52,2
2710  DATA 0,0,0,0,0,0,0,0
2760  DATA FOGO,NADA,COVARDE,ALTO,ARCO,BAIXO,MARCHE,ESPADA,DISPOSTO
2780  DATA STATUS,MACHADO,BRAVO,RETIRADA,LANCA,VALENTE
2790  DATA CAVALEIROS,SARGENTOS,LANCEIROS,LANCEIROS,ARQUEIROS,ARQUEIROS,CAMPONESES,CAMPONESES
2800  DATA NADA,CAMPO,GIBAO,VILA,MALHA METALICA,FLORESTA,CHAPA METALICA,MONTANHA
2810  DATA 5,4,3,5,3,3,4,3,2,3,3,1,2,2,1,2,3,2,3,2,0,3,1,0
3000  REM ALCANCE
3010 GP =  - 1
3020  FOR M = RA TO (RA + 7)
3030 XX =  ABS (T(M,8) - T(RB,8)):YY =  ABS (T(M,9) - T(RB,9))
3040  IF XX < RC AND YY < RD AND T(M,1) < 4 THEN RC = XX:RD = YY:GP = M
3050  NEXT M
3060  RETURN
3100  REM PODER
3110  IF T(V,1) > 3 THEN  RETURN
3120 XX =  ABS (T(V,8) - T(E,8)):YY =  ABS (T(V,9) - T(E,9))
3130  IF T(V,7) >  = T(E,7) AND XX < 5 AND YY < 5 THEN MV = T(V,2)
3140  IF XX < HP AND YY < VP THEN HP = XX:VP = YY:ZP = 1: RETURN
3150  RETURN
3200  REM CONCENTRACAO
3210  IF HP >  = 0 THEN LP = 1
3220  IF HP < 0 THEN LP = 3:HP =  ABS (HP)
3230  IF VP >  = 0 AND  ABS (VP) > HP THEN LP = 2
3240  IF VP < 0 AND  ABS (VP) > HP THEN LP = 4:VP =  ABS (VP)
3250 T(E,2) = LP
3260  RETURN
10000  REM FLASH
10010  POKE 277,T(TT,8): POKE 278,T(TT,9)
10020  FOR K = 1 TO 10
10030  INVERSE :N =  USR (U$(TT))
10040  NORMAL :N =  USR (U$(TT))
10050  NEXT K
10060  RETURN
65000  REM INSTALADOR
65010  PRINT "INSTALANDO HGRPRINT. AGUARDE..."
65020  RESTORE 65000
65030  READ E: IF E =  - 1 THEN  RETURN
65040  READ B: IF B =  - 1 THEN 65030
65050  POKE E,B:E = E + 1: GOTO 65040
65100  REM CONFIGURA USR()
65110  DATA 771
65120  DATA 195,176,60,-1
65130  REM ROTINA DE IMPRESSAO EM HGR
65140  DATA 15536
65150  DATA 205,161,232,200,71,35,35,78,35,102,105,229,33,21,1,86,35,94,33,,128,25,235,225,205,134,200,126,214,32,56,41
65160  DATA 229,213,197,38,,111,41,41,41,1,,61,9,58,82,3,214,1,159,47,79,6,8,126,169,18,35,123,198,32,95,122
65170  DATA 206,,87,16,242,193,209,225,19,35,16,207,195,121,200,-1
65180  REM TABELA DE CARACTERES
65190  DATA 15616
65200  DATA ,,,,,,,,16,16,16,16,16,,16,,40,40,40,,,,,,40,40,124,40,124,40,40,
65210  DATA 16,60,80,56,20,120,16,,96,100,8,16,32,76,12,,32,80,80,32,84,72,52,,16,16,16,,,,,
65220  DATA 8,16,32,32,32,16,8,,32,16,8,8,8,16,32,,16,84,56,16,56,84,16,,,16,16,124,16,16,,
65230  DATA ,,,,16,16,32,,,,,124,,,,,,,,,,,16,,,4,8,16,32,64,,
65240  DATA 56,68,76,84,100,68,56,,16,48,16,16,16,16,56,,56,68,4,24,32,64,124,,124,4,8,24,4,68,56,
65250  DATA 8,24,40,72,124,8,8,,124,64,120,4,4,68,56,,28,32,64,120,68,68,56,,124,4,8,16,32,32,32,
65260  DATA 56,68,68,56,68,68,56,,56,68,68,60,4,8,112,,,,16,,16,,,,,,16,,16,16,32,
65270  DATA 8,16,32,64,32,16,8,,,,124,,124,,,,32,16,8,4,8,16,32,,56,68,8,16,16,,16,
65280  DATA 56,68,84,92,88,64,60,,16,40,68,68,124,68,68,,120,68,68,120,68,68,120,,56,68,64,64,64,68,56,
65290  DATA 120,68,68,68,68,68,120,,124,64,64,120,64,64,124,,124,64,64,120,64,64,64,,60,64,64,64,76,68,60,
65300  DATA 68,68,68,124,68,68,68,,56,16,16,16,16,16,56,,4,4,4,4,4,68,56,,68,72,80,96,80,72,68,
65310  DATA 64,64,64,64,64,64,124,,68,108,84,84,68,68,68,,68,68,100,84,76,68,68,,56,68,68,68,68,68,56,
65320  DATA 120,68,68,120,64,64,64,,56,68,68,68,84,72,52,,120,68,68,120,80,72,68,,56,68,64,56,4,68,56,
65330  DATA 124,16,16,16,16,16,16,,68,68,68,68,68,68,56,,68,68,68,68,68,40,16,,68,68,68,84,84,108,68,
65340  DATA 68,68,40,16,40,68,68,,68,68,40,16,16,16,16,,124,4,8,16,32,64,124,,124,96,96,96,96,96,124,
65350  DATA ,64,32,16,8,4,,,124,12,12,12,12,12,124,,,,16,40,68,,,,,,,,,,,127
65440  DATA -1,-1
