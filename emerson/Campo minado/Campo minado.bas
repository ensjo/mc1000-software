1  CLEAR 512,15328: GOSUB 65000: CLEAR 
10  GOSUB 9000: REM INICIALIZA
20  GOSUB 4000: REM OBTEM COMANDO
30  IF  NOT FJ THEN 20
40  IF EM THEN 70
50  SET 5,MY + 3:I =  USR ("PARABENS!") PRINT 
60  GOTO 90
70  SET 5,MY + 3:I =  USR ("BUUUM!") PRINT 
80  GOSUB 6000: REM EXIBE MINAS
90  SET 16,MY + 3:I =  USR ("RECOMECAR? (S/N)") PRINT 
100 C$ =  USR (I) INPUT  WAIT : REM AGUARDA TECLA
110  IF C$ = "S" THEN  RUN 10
120  IF C$ = "N" THEN  TEXT : HOME : END 
130  GOTO 100
1000  REM EXIBE POSICAO (A,B)
1010  SET A + 1,B + 1
1020 I = C(A,B)
1030  IF I AND MM THEN 1110
1040  IF I AND MA THEN 1100
1050  IF I AND MC THEN 1080
1060  IF I AND MI THEN I =  USR ( CHR$ (106)) PRINT : RETURN : REM FECHADO MARCA INCERTA
1070 I =  USR (F$) PRINT : RETURN : REM FECHADO
1080  IF EM THEN I =  USR ( CHR$ (107)) PRINT : RETURN : REM FECHADO MARCA ERRADA
1090 I =  USR ( CHR$ (105)) PRINT : RETURN : REM FECHADO MARCA CERTA
1100 I =  USR ( CHR$ (A0 + (I AND MV))) PRINT : RETURN : REM ABERTO
1110  IF I AND MA THEN I =  USR ( CHR$ (117)) PRINT : RETURN : REM ABERTO EXPLOSAO
1120  IF I AND MC THEN I =  USR ( CHR$ (105)) PRINT : RETURN : REM FECHADO MARCA CERTA
1130  IF I AND MI THEN 1160
1140  IF EM THEN I =  USR (AM$) PRINT : RETURN : REM ABERTO MINA
1150 I =  USR ( CHR$ (104)) PRINT : RETURN : REM FECHADO
1160  IF EM THEN I =  USR (AM$) PRINT : RETURN : REM ABERTO MINA
1170 I =  USR ( CHR$ (106)) PRINT : RETURN : REM FECHADO MARCA INCERTA
2000  REM ABRE POSICAO ATUAL
2010 C = C(X,Y): IF C AND (MA OR MC) THEN  RETURN : REM NAO ABRE POSICAO JA ABERTA OU COM MARCA CERTA
2020 C = C AND  NOT MI OR MA:C(X,Y) = C: REM REMOVE MARCA INCERTA E ABRE POSICAO
2030 A = X:B = Y: GOSUB 1000: REM EXIBE POSICAO (X,Y)
2040  IF C AND MM THEN EM = SIM:FJ = SIM: RETURN : REM SE EXPLODIU MINA, FIM DE JOGO
2050 PR = PR - 1: IF PR = 0 THEN FJ = SIM: RETURN : REM SE ABRIU TODAS AS POSICOES SEM MINA, FIM DE JOGO
2060  IF C AND MV THEN  RETURN : REM SE ABRIU POSICAO VIZINHA A MINA, NAO PROPAGA
2070 X0 = X:Y0 = Y: REM PRESERVA POSICAO INICIAL
2080 D = 0: REM DIRECAO INICIAL PARA GIRO PELAS POSICOES VIZINHAS
2100  IF D <  = 7 THEN 2200
2110  REM COMPLETOU GIRO PELAS POSICOES VIZINHAS: RETORNAR PARA POSICAO ANTERIOR
2120  IF X = X0 AND Y = Y0 THEN  RETURN : REM POSICAO INICIAL: NAO HA PARA ONDE RETORNAR: TERMINA
2130  REM RETORNA A POSICAO ANTERIOR
2140 D = (C(X,Y) AND MR) / DR: REM DIRECAO DE RETORNO
2150 X = X + DX(D):Y = Y + DY(D): REM POSICAO ANTERIOR
2160 D = (C(X,Y) AND MP) / DP + 1: REM PROXIMA DIRECAO
2170  GOTO 2100
2200  REM PROXIMA POSICAO
2210 XX = X + DX(D): IF XX < 0 OR XX > MX THEN 2400
2220 YY = Y + DY(D): IF YY < 0 OR YY > MY THEN 2400
2230 C = C(XX,YY): IF C AND (MA OR MC) THEN 2400: REM NAO ABRE POSICAO JA ABERTA OU COM MARCA CERTA
2240 C = C AND  NOT MI OR MA:C(XX,YY) = C: REM REMOVE MARCA INCERTA E ABRE POSICAO
2250 A = XX:B = YY: GOSUB 1000: REM EXIBE POSICAO (XX,YY)
2260 PR = PR - 1: IF PR = 0 THEN FJ = SIM: RETURN : REM SE ABRIU TODAS AS POSICOES SEM MINA, FIM DE JOGO
2270  IF C AND MV THEN 2330
2280  REM POSICAO SEM MINAS VIZINHAS: PROPAGAR
2290 C(X,Y) = C(X,Y) AND  NOT MP OR (D * DP): REM REGISTRA DIRECAO NA POSICAO ATUAL
2300 C = C AND  NOT MR OR (((D + 4) AND 7) * DR):C(XX,YY) = C: REM REGISTRA DIRECAO DE RETORNO NA PROXIMA POSICAO
2310 X = XX:Y = YY: REM PROXIMA POSICAO
2320 D = 0: REM INICIA GIRO PELAS POSICOES VIZINHAS
2330  GOTO 2200
2400 D = D + 1: REM PROXIMA DIRECAO
2410  GOTO 2100
3000  REM MARCA POSICAO ATUAL
3010 C = C(X,Y): IF C AND MA THEN  RETURN : REM NAO MARCA POSICAO ABERTA
3020  IF C AND MC THEN C(X,Y) = C AND  NOT MC OR MI:QC = QC + 1: GOSUB 5000: GOTO 3050: REM SUBSTITUI MARCA CERTA POR MARCA INCERTA
3030  IF C AND MI THEN C(X,Y) = C AND  NOT MI: GOTO 3050: REM REMOVE MARCA INCERTA
3040 C(X,Y) = C OR MC:QC = QC - 1: GOSUB 5000: REM COLOCA MARCA CERTA
3050 A = X:B = Y: GOSUB 1000: RETURN 
4000  REM OBTEM COMANDO
4010  INVERSE :A = X:B = Y: GOSUB 1000: NORMAL : REM EXIBE CURSOR
4020 C$ =  USR (I) INPUT  WAIT : REM AGUARDA TECLA
4025 A = X:B = Y: GOSUB 1000: REM OCULTA CURSOR
4030  IF C$ = "W" THEN 4100
4040  IF C$ = "A" THEN 4150
4050  IF C$ = "S" THEN 4200
4060  IF C$ = "D" THEN 4250
4070  IF C$ = " " THEN 2000
4080  IF C$ = "M" THEN 3000
4085  IF C$ =  CHR$ (3) THEN  STOP 
4090  GOTO 4010
4100 Y = Y - 1: IF Y < 0 THEN Y = MY: REM CURSOR PARA CIMA
4110  RETURN 
4150 X = X - 1: IF X < 0 THEN X = MX: REM CURSOR PARA A ESQUERDA
4160  RETURN 
4200 Y = Y + 1: IF Y > MY THEN Y = 0: REM CURSOR PARA BAIXO
4210  RETURN 
4250 X = X + 1: IF X > MX THEN X = 0: REM CURSOR PARA A DIREITA
4260  RETURN 
5000  REM EXIBE CONTADOR
5010  SET 0,MY + 3:I =  USR ( STR$ (QC) + " ") PRINT : RETURN 
6000  REM EXIBE MINAS
6010  FOR A = 0 TO MX: FOR B = 0 TO MY
6020  IF C(A,B) AND (MM OR MC) THEN  GOSUB 1000
6030  NEXT B,A
6040  RETURN 
7000  REM EXIBE CAMPO
7005  SET 0,0:I =  USR ( CHR$ (96)) PRINT : SET MX + 2,0:I =  USR ( CHR$ (98)) PRINT : SET 0,MY + 2:I =  USR ( CHR$ (101)) PRINT : SET MX + 2,MY + 2:I =  USR ( CHR$ (103)) PRINT 
7010  FOR A = 0 TO MX: SET A + 1,0:I =  USR ( CHR$ (97)) PRINT : SET A + 1,MY + 2:I =  USR ( CHR$ (102)) PRINT 
7015  FOR B = 0 TO MY: IF A = 0 THEN  SET 0,B + 1:I =  USR ( CHR$ (99)) PRINT : SET MX + 2,B + 1:I =  USR ( CHR$ (100)) PRINT 
7020  GOSUB 1000
7030  NEXT B,A
7040  GOSUB 5000: REM EXIBE CONTADOR
7050  RETURN 
9000  REM INICIALIZA
9010  DIM X,Y,XX,YY,C,CC,MA,MM,MC,MI,MV,MP,DP,MR,DR,MX,MY,QM,A,B,I,PR,FJ,EM,SIM,NAO,QC,C$,F$,AM$
9020 I =  USR (I) INPUT  RUN : REM ATIVA ROTINA USR PARA TECLADO
9030 I =  RND ( - 65536 -  PEEK (264) * 256 -  PEEK (263)): REM RANDOMIZE
9040  GOSUB 9600: REM TELA INICIAL
9100  REM CONSTANTES
9110 MX = 29:MY = 20: REM TAMANHO DO CAMPO
9120 QM =  INT ((MX + 1) * (MY + 1) * .2): REM QUANTIDADE DE MINAS
9130 MV = 15: REM MASCARA P/ QUANTIDADE DE MINAS VIZINHAS
9140 MM = 16: REM MASCARA P/ MINA PRESENTE
9150 MA = 32: REM MASCARA P/ POSICAO ABERTA
9160 MC = 64: REM MASCARA P/ MARCA CERTA
9170 MI = 128: REM MASCARA P/ MARCA INCERTA
9180 DP = 256: REM DIVISOR P/ DIRECAO DE PROPAGACAO DA ABERTURA
9190 MP = DP * 7: REM MASCARA P/ DIRECAO DE PROPAGACAO DA ABERTURA
9200 DR = 2048: REM DIVISOR P/ DIRECAO DE RETORNO DA PROPAGACAO DA ABERTURA
9210 MR = DR * 7: REM MASCARA P/ DIRECAO DE RETORNO DA PROPAGACAO DA ABERTURA
9220 NAO = 0: REM FALSO
9230 SIM =  NOT NAO: REM VERDADEIRO
9240 F$ =  CHR$ (104): REM SPRITE FECHADO
9250 AM$ =  CHR$ (118): REM SPRITE ABERTO MINA
9260 A0 = 108: REM SPRITE ABERTO
9270  DIM DX(7),DY(7): REM DIRECOES
9280  RESTORE 9280: FOR I = 0 TO 7: READ DX(I),DY(I): NEXT I: DATA 0,-1,+1,-1,+1,0,+1,+1,0,+1,-1,+1,-1,0,-1,-1
9300  REM VARIAVEIS
9310 PR = (MX + 1) * (MY + 1) - QM: REM POSICOES RESTANTES A ABRIR
9315 QC = QM: REM QUANTIDADE DE MARCAS CERTAS RESTANTES
9320 FJ = NAO: REM FIM DE JOGO
9330 EM = NAO: REM EXPLODIU MINA
9400  DIM C(MX,MY): REM CAMPO MINADO
9410  FOR I = 1 TO QM
9420  REM POSICIONA MINA EM POSICAO SEM MINA
9430 X =  INT ( RND (1) * (MX + 1)):Y =  INT ( RND (1) * (MY + 1))
9440  IF C(X,Y) AND MM THEN 9430
9450 C(X,Y) = C(X,Y) OR MM
9460  REM INCREMENTA QUANTIDADE DE MINAS VIZINHAS NAS POSICOES VIZINHAS
9470  FOR XX = X -  ABS (X > 0) TO X +  ABS (X < MX)
9480  FOR YY = Y -  ABS (Y > 0) TO Y +  ABS (Y < MY)
9490  IF  NOT (XX = X AND YY = Y) THEN C(XX,YY) = C(XX,YY) + 1
9500  NEXT YY,XX,I
9510 X =  INT (MX / 2):Y =  INT (MY / 2): REM POSICAO INICIAL
9520  HGR : GOSUB 7000: REM EXIBE CAMPO
9530  RETURN 
9600  REM TELA INICIAL
9610  HGR 
9620  SET 3,1: INVERSE :I =  USR (" C A M P O   M I N A D O ") PRINT : NORMAL 
9630  SET 9,3: INVERSE :I =  USR ("(MINESWEEPER)") PRINT : NORMAL 
9640  SET 5,8:I =  USR ("W,A,S,D = MOVE CURSOR") PRINT 
9650  SET 11,10:I =  USR ("M = ALTERNA MARCA") PRINT 
9660  SET 7,12:I =  USR ("SPACE = ABRE POSICAO") PRINT 
9670  SET 0,17:I =  USR ("EMERSON COSTA - NOVEMBRO DE 2024") PRINT 
9680  SET 3,22:I =  USR ("INICIALIZANDO, AGUARDE...") PRINT 
9690  RETURN 
64999  STOP 
65000  REM INSTALADOR
65010  POKE 836,0: TEXT : HOME : PRINT "INSTALANDO ROTINAS USR. AGUARDE.";
65020  RESTORE 65100
65030  READ E: IF E =  - 1 THEN  PRINT "OK.": RETURN 
65040  READ B: IF B =  - 1 THEN 65030
65050  POKE E,B:E = E + 1: GOTO 65040
65100  REM CONFIGURA USR()
65110  DATA 771
65120  DATA 195,225,59,-1
65130  REM PACOTE DE ROTINAS USR
65140  DATA 15329
65150  DATA 225,227,126,254,133,194,117,60,205,160,221,254,138,40,65,254,144,55,40,60,254,148,32,23,205,160,221,229,58,46,1,183,32,5,205,71,195,24,245,205,57,195,225,62,255,24,3,205,39,192,227,50,31,1,183,32,8,33,144,3,54,1,195,29,229,62,1,205,230,230,58,27
65160  DATA 1,42,164,3,119,195,20,231,229,33,32,1,17,68,60,1,71,60,205,44,61,225,205,160,221,227,233,,,,195,74,60,33,14,,57,126,254,93,192,35,126,254,221,192,33,8,,57,54,97,35,54,60,201,193,209,51,51,50,31,1,183,58,27,1,50,28,1,196,223,221,195,97,221,254,151
65170  DATA 194,41,61,205,160,221,254,220,202,30,61,227,229,205,161,232,200,71,35,35,78,35,102,105,237,91,89,3,122,83,95,205,134,200,126,35,254,10,32,6,30,32,205,226,60,175,214,32,56,47,79,205,226,60,121,229,213,197,33,,128,25,235,38,,111,41,41,41,1,71,61,9
65180  DATA 58,82,3,214,1,159,47,79,6,8,126,169,18,35,123,198,32,95,16,246,193,209,225,19,16,191,99,106,34,89,3,195,121,200,123,230,224,40,9,7,7,7,130,87,123,230,31,95,122,214,24,216,22,23,229,213,197,60,254,24,56,2,62,24,71,14,,17,,128,98,107,9,62,24,144,40
65190  DATA 5,197,71,237,176,193,98,107,113,19,11,237,176,193,209,225,201,205,160,221,227,229,17,71,61,195,38,230,195,72,216,26,48,7,235,1,70,61,254,1,159,183,192,197,229,1,3,,197,237,176,193,209,225,237,176,201,
65200  DATA ,,,,,,,,,16,16,16,16,,16,,,36,36,,,,,,,36,126,36,36,126,36,
65210  DATA ,8,62,40,62,10,62,8,,98,100,8,16,38,70,,,16,40,16,42,68,58,,,8,16,,,,,
65220  DATA ,4,8,8,8,8,4,,,32,16,16,16,16,32,,,,20,8,62,8,20,,,,8,8,62,8,8,
65230  DATA ,,,,,8,8,16,,,,,62,,,,,,,,,24,24,,,,2,4,8,16,32,
65240  DATA ,60,70,74,82,98,60,,,24,40,8,8,8,62,,,60,66,2,60,64,126,,,60,66,12,2,66,60,
65250  DATA ,8,24,40,72,126,8,,,126,64,124,2,66,60,,,60,64,124,66,66,60,,,126,2,4,8,16,16,
65260  DATA ,60,66,60,66,66,60,,,60,66,66,62,2,60,,,,,16,,,16,,,,16,,,16,16,32
65270  DATA ,,4,8,16,8,4,,,,,62,,62,,,,,16,8,4,8,16,,,60,66,4,8,,8,
65280  DATA ,60,74,86,94,64,60,,,60,66,66,126,66,66,,,124,66,124,66,66,124,,,60,66,64,64,66,60,
65290  DATA ,120,68,66,66,68,120,,,126,64,124,64,64,126,,,126,64,124,64,64,64,,,60,66,64,78,66,60,
65300  DATA ,66,66,126,66,66,66,,,62,8,8,8,8,62,,,2,2,2,66,66,60,,,68,72,112,72,68,66,
65310  DATA ,64,64,64,64,64,126,,,66,102,90,66,66,66,,,66,98,82,74,70,66,,,60,66,66,66,66,60,
65320  DATA ,124,66,66,124,64,64,,,60,66,66,82,74,60,,,124,66,66,124,68,66,,,60,64,60,2,66,60,
65330  DATA ,254,16,16,16,16,16,,,66,66,66,66,66,60,,,66,66,66,66,36,24,,,66,66,66,66,90,36,
65340  DATA ,66,36,24,24,36,66,,,130,68,40,16,16,16,,,126,4,8,16,32,126,,,14,8,8,8,8,14,
65350  DATA ,,64,32,16,8,4,,,112,16,16,16,16,112,,,16,40,68,,,,,,,,,,,,255
65400  DATA 255,255,255,255,255,253,250,252: REM BORDA SUPERIOR ESQUERDA
65401  DATA 255,255,255,255,255,85,170,: REM BORDA SUPERIOR
65402  DATA 255,255,255,255,239,79,175,79: REM BORDA SUPERIOR DIREITA
65402  DATA 250,252,250,252,250,252,250,252: REM BORDA ESQUERDA
65404  DATA 175,207,175,207,175,207,175,207: REM BORDA DIREITA
65405  DATA 250,253,250,240,255,255,255,255: REM BORDA INFERIOR ESQUERDA
65406  DATA 255,85,170,,255,255,255,255: REM BORDA INFERIOR
65407  DATA 175,79,175,15,255,255,255,255: REM BORDA INFERIOR DIREITA
65408  DATA 254,212,170,212,170,212,170,: REM FECHADO
65409  DATA 254,142,128,130,190,180,170,: REM FECHADO MARCA CERTA
65410  DATA 254,194,152,242,166,252,166,: REM FECHADO MARCA INCERTA
65411  DATA 254,188,218,230,230,218,188,: REM FECHADO MARCA ERRADA
65412  DATA 170,127,255,127,255,127,255,127: REM ABERTO
65413  DATA 170,103,199,103,231,103,195,127: REM ABERTO "1"
65414  DATA 170,67,153,121,195,31,129,127: REM ABERTO "2"
65415  DATA 170,67,185,99,249,25,195,127: REM ABERTO "3"
65416  DATA 170,99,195,19,129,115,243,127: REM ABERTO "4"
65417  DATA 170,1,159,3,249,25,195,127: REM ABERTO "5"
65418  DATA 170,67,159,3,153,25,195,127: REM ABERTO "6"
65419  DATA 170,65,153,115,231,103,231,127: REM ABERTO "7"
65420  DATA 170,67,153,67,153,25,195,127: REM ABERTO "8"
65421  DATA 170,107,167,88,155,101,214,119: REM ABERTO EXPLOSAO
65422  DATA 170,103,211,33,129,67,231,127: REM ABERTO MINA
65423  DATA -1,-1
